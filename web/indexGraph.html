<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>D3 Test</title>
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"> -->
    <link rel="stylesheet" href="AdminLTE/bower_components/bootstrap/dist/css/bootstrap.min.css">
    <!-- jQuery library -->
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> -->
    <script src="AdminLTE/bower_components/jquery/dist/jquery.min.js"></script>
    <script src"AdminLTE/plugins/jQueryUI/jquery-ui.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script> -->



    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.0.0/bootstrap-slider.js"></script> -->
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.0.0/css/bootstrap-slider.css"> -->
    <!-- Font Awesome -->
    <link rel="stylesheet" href="AdminLTE/bower_components/font-awesome/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="AdminLTE/bower_components/Ionicons/css/ionicons.min.css">
    <!-- bootstrap slider -->
    <link rel="stylesheet" href="AdminLTE/plugins/bootstrap-slider/slider.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="AdminLTE/dist/css/AdminLTE.min.css">
    <link rel="stylesheet" href="AdminLTE/dist/css/skins/_all-skins.min.css">
    <!-- FastClick -->
    <!-- <script src="AdminLTE/plugins/fastclick/fastclick.min.js"></script> -->
    <!-- AdminLTE App -->
    <!-- <script src="AdminLTE/dist/js/adminlte.min.js"></script> -->
    <!-- SlimScroll -->
    <!-- <script src="AdminLTE/bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script> -->
    <!-- <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script> -->
    <!-- <script src"AdminLTE/plugins/bootstrap-slider/bootstrap-slider.js"></script> -->

    <style>
    canvas {
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
    }
    </style>
</head>
<body>
    <!-- <div class="row">
    <div class="col-lg-6">
    <p>My first paragraph.</p>
</div>
<div class="col-lg-6">
<p>My first paragraph2</p>
</div>
</div> -->
<div class="row">
    <div class="col-lg-12">
        <div style="width:75%; text-align: center;">
            <canvas id="canvas"></canvas>
        </div>
    </div>
</div>
<div class="row margin">
    <div class="col-lg-6" style="text-align: left">
        <button type="button" class="btn btn-success" id="display">Display data</button>
    </div>
    <div class="col-lg-6">
        <input type="text" id="slider-age" value="" class="slider form-control" data-slider-min="3" data-slider-max="78" data-slider-step="1" data-slider-value="[3,78]" data-slider-orientation="horizontal" data-slider-selection="before" data-slider-tooltip="show" data-slider-id="red">
    </div>
</div>





<!-- ---------------------- JAVASCRIPT ------------------- -->
<!-- jQuery 3 -->
<script src="AdminLTE/bower_components/jquery/dist/jquery.min.js"></script>
<!-- Bootstrap 3.3.7 -->
<script src="AdminLTE/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- FastClick -->
<script src="AdminLTE/bower_components/fastclick/lib/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="AdminLTE/dist/js/adminlte.min.js"></script>
<!-- AdminLTE for demo purposes -->
<!-- <script src="AdminLTE/dist/js/demo.js"></script> -->
<!-- Bootstrap slider -->
<script src="AdminLTE/plugins/bootstrap-slider/bootstrap-slider.js"></script>
<script src="js/utils.js"></script>

<script src="https://d3js.org/d3.v4.min.js"></script>

<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/javascript.util/0.12.12/javascript.util.min.js"></script>

<script type="text/javascript">
window.onload = function(){
    var scatterChartData = {
        datasets: [{
            label: "My First dataset",
            // borderColor: window.chartColors.red,
            // backgroundColor: color(window.chartColors.red).alpha(0.2).rgbString(),
            data: []
        }]
    };
    var ctx = document.getElementById("canvas").getContext("2d");
    window.myScatter = Chart.Scatter(ctx, {
        data: scatterChartData,
        options: {
            title: {
                display: true,
                text: 'Chart.js Scatter Chart'
            },
        }
    });
    // $(function () {
      $('.slider').slider();
    // })
}

function Personne(age, bmi, entrerep, mfruit, bonalim, tele, mvian, mpois, fastfood, aptotal_hebdo, region) {
    this.age = age;
    this.bmi = bmi;
    this.entrerep = entrerep;
    this.mfruit = mfruit;
    this.bonalim = bonalim;
    this.tele = tele;
    this.mvian = mvian;
    this.mpois = mpois;
    this.fastfood = fastfood;
    this.aptotal_hebdo = aptotal_hebdo;
    this.region = region;
}
var personnes = [];
$("#slider-age").change(function(){
    var values = $("#slider-age").attr("data-value").split(",");
    var min = values[0];
    var max = values[1];
    personnes = [];
    d3.csv("src/Table_indiv.csv", function(data) {
        data.forEach(function(d) {
            d.bmi = +d.bmi;
            d["v2_age"] = +d["v2_age"];
            if(!isNaN(d.bmi) && d.bmi.toString().indexOf('.') != -1 && !isNaN(d.bmi) && d.bmi.toString().indexOf('.') != -1 && d["v2_age"] >= min && d["v2_age"] <= max){
                var personneTemp = new Personne(d["v2_age"], d.bmi, d.entrerep, d.mfruit, d.bonalim, d.tele, d.mvian, d.mpois, d.fastfood, d.aptotal_hebdo, d.region);
                personnes.push(personneTemp);
            }
        });
        personnes.sort(function(a, b) {
            return a.age - b.age;
        })
        makeAverage(personnes);
        myDataIsReady();
    });

});
$("#display").click(function () {
    personnes = [];
    d3.csv("src/Table_indiv.csv", function(data) {
        data.forEach(function(d) {
            d.bmi = +d.bmi;
            d["v2_age"] = +d["v2_age"];
            if(!isNaN(d.bmi) && d.bmi.toString().indexOf('.') != -1 && !isNaN(d.bmi) && d.bmi.toString().indexOf('.') != -1){
                var personneTemp = new Personne(d["v2_age"], d.bmi, d.entrerep, d.mfruit, d.bonalim, d.tele, d.mvian, d.mpois, d.fastfood, d.aptotal_hebdo, d.region);
                personnes.push(personneTemp);
            }
        });
        personnes.sort(function(a, b) {
            return a.age - b.age;
        })
        makeAverage(personnes);
        myDataIsReady();
    });
});

function makeAverage(tabToMakeAverage){
    console.log(tabToMakeAverage);
    var currentAge = tabToMakeAverage[0].age;
    //var newPersonnes = [];
    personnes = []
    var counter = 1;
    var sum = tabToMakeAverage[0].bmi;
    for (var key in tabToMakeAverage){
        var ageCour = tabToMakeAverage[key].age;
        var imcCour = tabToMakeAverage[key].bmi;
        if (ageCour != currentAge){
            personnes.push({x: currentAge, y: sum / counter});
            currentAge = ageCour;
            sum = imcCour;
            counter = 1;
        }else{
            sum += imcCour;
            counter++;
        }
    }
}

function myDataIsReady() {
    var color = Chart.helpers.color;
    //console.log(personnes);
    var scatterChartData = {
        datasets: [{
            label: "My First dataset",
            borderColor: window.chartColors.red,
            backgroundColor: color(window.chartColors.red).alpha(0.2).rgbString(),
            data: personnes
        }]
    };
    var ctx = document.getElementById("canvas").getContext("2d");
    window.myScatter = Chart.Scatter(ctx,{
        data: scatterChartData,
        options: {
            title: {
                display: true,
                text: 'Chart.js Scatter Chart'
            },
        }
    });
};
</script>
<!-- Bootstrap slider -->
<script>

</script>
</body>
</html>
